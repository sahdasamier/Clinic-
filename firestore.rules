rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // ðŸ”’ Users collection - Allow authenticated users to read and write
    match /users/{userId} {
      // Allow users to read/write their own document
      allow read, write: if request.auth != null && request.auth.uid == userId;
      // Allow all authenticated users to read user documents (for admin functions)
      allow read: if request.auth != null;
      // Allow authenticated users to create user documents (for admin user creation)
      allow create: if request.auth != null;
    }
    
    // ðŸ”’ Patients collection - Allow authenticated users
    match /patients/{patientId} {
      allow read, write, create: if request.auth != null;
    }
    
    // ðŸ”’ Appointments collection - Allow authenticated users
    match /appointments/{appointmentId} {
      allow read, write, create: if request.auth != null;
    }
    
    // ðŸ”’ Doctor-Patient Assignments - Allow authenticated users
    match /doctor_patient_assignments/{assignmentId} {
      allow read, write, create: if request.auth != null;
    }
    
    // ðŸ”’ Medical Records - Allow authenticated users
    match /medicalRecords/{recordId} {
      allow read, write, create: if request.auth != null;
    }
    
    // ðŸ”’ Inventory collection - Allow authenticated users
    match /inventory/{inventoryId} {
      allow read, write, create: if request.auth != null;
    }
    
    // ðŸ”’ Payments collection - Allow authenticated users  
    match /payments/{paymentId} {
      allow read, write, create: if request.auth != null;
    }
    
    // ðŸ”’ Clinics collection - Special rules for demo clinic, otherwise require auth
    match /clinics/{clinicId} {
      // Allow unauthenticated read access to demo clinic for app initialization
      allow read: if clinicId == 'demo-clinic' || request.auth != null;
      // Only authenticated users can write/create clinics
      allow write, create: if request.auth != null;
    }
    
    // ðŸ”’ User invitations - Allow authenticated users
    match /user_invitations/{invitationId} {
      allow read, write, create: if request.auth != null;
    }
    
    // ðŸ”’ Invitations - Allow authenticated users
    match /invitations/{invitationId} {
      allow read, write, create: if request.auth != null;
    }
    
    // ðŸ”’ Any other collections - Allow authenticated users
    match /{document=**} {
      allow read, write, create: if request.auth != null;
    }
  }
} 